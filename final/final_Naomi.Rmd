---
title: "ESP106 Final Project"
author: "Naomi"
date: "2023-03-06"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ESP 106 Final Project

## Question

Do Metropolitan Statistical Area (MSA) neighborhood status affect
households' transportation mode choice?

## Objective

To compare the transportation mode choice between households living in
different MSA category defined in NHTS.

## Variables

### Independent variables:

Metropolitan Statistical Area (MSA) neighborhood status:

1.  MSA of 1 million or more population, with rail infrastructure

2.  MSA of 1 million or more population, without rail infrastructure

3.  MSA less than 1 million

4.  Not in MSA

### Dependent variables:

Transportation mode choices:

1.  Car

2.  Bus

3.  Train

4.  Taxi

5.  Bike

6.  Walk

## Data Source

[National Household Travel Survey 2017](https://nhts.ornl.gov/)

[Data Summary of NHTS on
GitHub](https://github.com/Westat-Transportation/summarizeNHTS.git)

## Workflow

Install 'devtools' package to download NHTS data set from GitHub

```{r}
# install.packages('devtools')
# devtools::install_github('Westat-Transportation/summarizeNHTS')
```

Download the NHTS 2017 data set to personal GitHub cloud storage

```{r}
library(summarizeNHTS)

setwd("C:/Users/Benny Panjaitan/Documents/GitHub/esp106-Naomi/final")

# download_nhts_data("2017", exdir="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

# nhts_data <- read_data("2017", csv_path="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

summary(nhts_data$data)
```

```{r}
nhts_data$data$household
```

Storing data summary of household trips count made in different Metropolitan arean based on transportation mode

```{r}
msatrip_sum <- summarize_data(
    data = nhts_data,
    agg = "trip_count",
    label = F,
    by = c("MSACAT","CAR","TAXI","WALK","BIKE","BUS","TRAIN")
)
```

Tidying up the data frame

1. Removing columns containing these values

"W" (Weighted statistic),

"E" (Standard error of the weighted statistic),

"S" (Surveyed/sampled statistic), and

Keeping the column of "N" (Number of observations/sample size) to show the value of trips made.

```{r}
msa_trip <- msatrip_sum[,-8:-10]
head(msa_trip)
```

2. Combining multiple columns of all transportation mode into one column to show what mode used in the trip, under the column of "MODE"

```{r}
msa_trip <- tidyr::gather(msa_trip, key="MODE", value="TRIP", 2:7)
head(msa_trip)
```

3. Keeping only trip frequencies, eliminating all unknown or unspecified trip frequencies

```{r}
msa_trip <- subset(msa_trip, TRIP %in% c("01", "02", "03", "04", "05"))
head(msa_trip)
```

4. Replacing strings in MSACAT column into simpler wording (**PENDING**)

```{r}

# function(MSACAT) lapply(strwrap(MSACAT, width = 20, simplify = FALSE), paste, collapse="\n")) 
```


Plotting the number of trips made in different metropolitan area category by transportation mode use.

```{r}
msa_trip %>%
ggplot(aes(x=MSACAT, y=N, fill=TRIP)) +  
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~MODE)  + 
  labs(title="Trips Made in Metropolitan Area by Transportation Mode", 
       y = "Number of Trips", x = element_blank()) +
  scale_fill_discrete(name ="Trip Frequency", labels =c("Daily", "Once in a week", "Once in a month", "Once in a year", "Never")) +
  scale_x_discrete(labels = c("MSA ≥ 1 million,\n with rail", "MSA ≥ 1 million,\n no rail", "MSA < 1 million", "Not MSA")) +
  scale_y_continuous(label = scales::comma) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```



