---
title: "ESP106 Final Project"
author: "Naomi"
date: "2023-03-06"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ESP 106 Final Project

## Question

Do Metropolitan Statistical Area (MSA) neighborhood status affect
households' transportation mode choice?

## Objective

To compare the transportation mode choice between households living in
different MSA category defined in NHTS.

## Variables

### Independent variables:

Metropolitan Statistical Area (MSA) neighborhood status:

1.  MSA of 1 million or more population, with rail infrastructure

2.  MSA of 1 million or more population, without rail infrastructure

3.  MSA less than 1 million

4.  Not in MSA

### Dependent variables:

Transportation mode choices:

1.  Car

2.  Bus

3.  Train

4.  Taxi

5.  Bike

6.  Walk

## Data Source

[National Household Travel Survey 2017](https://nhts.ornl.gov/)

[Data Summary of NHTS on
GitHub](https://github.com/Westat-Transportation/summarizeNHTS.git)

## Workflow

Install 'devtools' package to download NHTS data set from GitHub

```{r}
#install.packages('devtools')
#devtools::install_github('Westat-Transportation/summarizeNHTS')
```

Download the NHTS 2017 data set to personal GitHub cloud storage

```{r}
library(summarizeNHTS)

setwd("C:/Users/Benny Panjaitan/Documents/GitHub/esp106-Naomi/final")

# download_nhts_data("2017", exdir="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

# nhts_data <- read_data("2017", csv_path="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

summary(nhts_data$data)
```

```{r}
# 2017 variables table
cb_var <- codebook_2017$variables
```

```{r}
# 2017 values table
head(codebook_2017$values)
```


```{r}
nhts_data$data$household
```

Storing data summary of household trips count made in different Metropolitan area based on transportation mode

```{r}
msatrip_sum <- summarize_data(
    data = nhts_data,
    agg = "household_trip_rate",
    label = F,
    by = c("MSACAT","CAR","TAXI","WALK","BIKE","BUS","TRAIN")
)
```

Tidying up the data frame

1. Removing columns containing these values

"E" (Standard error of the weighted statistic),

"S" (Surveyed/sampled statistic), and 

"N" (Number of observations/sample size)

Keeping the column of "W" (Weighted statistic) to show a sample unit proportionally to the population.

```{r}
msa_trip <- msatrip_sum[,-9:-11]
head(msa_trip)
```

2. Combining multiple columns of all transportation mode into one column to show what mode used in the trip, under the column of "MODE"

```{r}
msa_trip <- tidyr::gather(msa_trip, key="MODE", value="TRIP", 2:7)
head(msa_trip)
```

3. Keeping only trip frequencies, eliminating all unknown or unspecified trip frequencies

```{r}
msa_trip <- subset(msa_trip, TRIP %in% c("01", "02", "03", "04", "05"))
head(msa_trip)
```


Plotting the number of trips made in different metropolitan area category by transportation mode use.

```{r}
msa_trip %>%
ggplot(aes(x=MSACAT, y=W, fill=TRIP)) +  
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~MODE)  + 
  labs(title="Household Trips in Metropolitan Area by Transportation Mode", 
       y = "Household Trips Rate", x = element_blank()) +
  scale_fill_discrete(name ="Trip Frequency", labels =c("Daily", "Once in a week", "Once in a month", "Once in a year", "Never")) +
  scale_x_discrete(labels = c("MSA ≥ 1 million,\n with rail", "MSA ≥ 1 million,\n no rail", "MSA < 1 million", "Not MSA")) +
  scale_y_continuous(label = scales::comma) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

```{r}
statistic <- summarize_data(
  data = nhts_data,
  agg = "household_trip_rate",
  by = "HHSTFIPS"
)

make_map(statistic)
```

```{r}
statistic1 <- summarize_data(
  data = nhts_data,
  agg = "household_trip_rate",
  by = "HHSTFIPS",
  exclude_missing = TRUE
)

statistic2 <- summarize_data(
  data = nhts_data,
  agg = "household_trip_rate",
  by = c("HHSTFIPS","CAR"),
  exclude_missing = TRUE
)

map <- make_map(
  tbl = statistic1, 
  tbl2 = statistic2
)

map
```

