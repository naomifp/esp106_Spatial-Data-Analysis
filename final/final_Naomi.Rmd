---
title: "ESP106 Final Project"
author: "Naomi"
date: "2023-03-06"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ESP 106 Final Project

## Question

Do Metropolitan Statistical Area (MSA) neighborhood status affect
households' transportation mode choice?

## Objective

To compare the transportation mode choice between households living in
different MSA category defined in NHTS.

## Variables

### Independent variables:

Metropolitan Statistical Area (MSA) neighborhood status:

1.  MSA of 1 million or more population, with rail infrastructure

2.  MSA of 1 million or more population, without rail infrastructure

3.  MSA less than 1 million

4.  Not in MSA

### Dependent variables:

Transportation mode choices:

1.  Car

2.  Bus

3.  Train

4.  Taxi

5.  Bike

6.  Walk

## Data Source

[National Household Travel Survey 2017](https://nhts.ornl.gov/)

[Data Summary of NHTS on
GitHub](https://github.com/Westat-Transportation/summarizeNHTS.git)

## Workflow

Install 'devtools' package to download NHTS data set from GitHub

```{r}
# install.packages('devtools')
devtools::install_github('Westat-Transportation/summarizeNHTS')
```

Download the NHTS 2017 data set to personal GitHub cloud storage

```{r}
library(summarizeNHTS)

setwd("C:/Users/Benny Panjaitan/Documents/GitHub/esp106-Naomi/final")

download_nhts_data("2017", exdir="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

nhts_data <- read_data("2017", csv_path="C:\\Users\\Benny Panjaitan\\Documents\\GitHub\\esp106-Naomi\\final")

summary(nhts_data$data)
```

```{r}
nhts_data$data$household
```

```{r}
cd_var <- codebook_2017$variables
cd_val <- codebook_2017$values
car <- subset(cd_val, cd_val$NAME == "CAR")
freq <- as.vector(car[4:8,3])
```



```{r}
msa_trip <- summarize_data(
    data = nhts_data,
    agg = "trip_count",
    label = TRUE,
    by = c("MSACAT","CAR","TAXI","WALK","BIKE","BUS","TRAIN")
)
```

```{r}
msa_trip <- msa_trip[,-8:-10]
catg <- catg[-1]
freq
```

```{r}
msa_trip <- tidyr::gather(msa_trip, key="MODE", value="TRIP", 2:7)
msa_trip <- subset(msa_trip, TRIP %in% c("Daily", "A few times a week", "A few times a month", "A few times a year", "Never"))

```


Make data frames

```{r}
ggplot(msa_trip, aes(x=MSACAT, y=N, fill=TRIP)) +  
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~MODE)  + 
  labs(title="Trips Made in Metropolitan Area by Transportation Mode", 
       y = "Number of Trips") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        axis.title.x = element_blank()) +
  scale_y_continuous(label = scales::comma)
```

